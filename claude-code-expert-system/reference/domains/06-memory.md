---
domain: memory
semantic_triggers: memory, CLAUDE.md, context, remember, project context, rules, .claude/rules/, memory management, /memory, session persistence, /init, /clear, context window, compaction, project knowledge, codebase context
priority_sources:
  - https://code.claude.com/docs/en/memory
  - https://www.anthropic.com/engineering/claude-code-best-practices
  - https://claudelog.com/
related_domains:
  - 03-skills.md
  - 13-workflows.md
  - 07-plan-mode.md
---

# Memory & Context Reference

## Quick Answer

CLAUDE.md is your **project's memory file** — automatically loaded when Claude Code starts in that directory. Keep it concise (50-250 lines) with project conventions, architecture decisions, and key commands. Use `.claude/rules/` for scoped rules that apply to specific file paths. Use `/clear` between major tasks to reset context, and `/init` to reload memory.

## Key Concepts

### Memory Hierarchy

| Level | Location | Purpose | Loaded When |
|-------|----------|---------|-------------|
| **Project Memory** | `./CLAUDE.md` or `./.claude/CLAUDE.md` | Project conventions, architecture | Session start in directory |
| **User Memory** | `~/.claude/CLAUDE.md` | Personal preferences, global patterns | Every session |
| **Scoped Rules** | `.claude/rules/*.md` | Path-specific rules | When matching files accessed |

### CLAUDE.md Best Practices

**DO:**
- Keep concise: 50-250 lines ideal
- Focus on "what Claude needs to know"
- Include key commands (test, build, deploy)
- Document architectural decisions
- List coding conventions
- Note gotchas and warnings

**DON'T:**
- Duplicate documentation available elsewhere
- Include full API references
- Add verbose explanations
- Exceed ~500 lines (impacts context)

### Memory Commands

| Command | Effect |
|---------|--------|
| `/memory` | View currently loaded memory |
| `/init` | Reload CLAUDE.md and rules |
| `/clear` | Reset context window completely |

### Session Management
- **Recommended session length:** 2-3 hours max
- **Use `/clear`** between unrelated tasks
- **Context window:** 200K tokens (fills up in long sessions)
- **Compaction:** Claude auto-compacts when context is full (may lose detail)

## Authoritative Sources

| Source | Type | URL |
|--------|------|-----|
| Memory Documentation | Official Docs | https://code.claude.com/docs/en/memory |
| Best Practices | Blog | https://www.anthropic.com/engineering/claude-code-best-practices |
| Claudelog Guide | Community | https://claudelog.com/ |
| Customisation Guide | Community | https://alexop.dev/posts/claude-code-customization-guide-claudemd-skills-subagents/ |

## Common Patterns

### Minimal CLAUDE.md Template
```markdown
# Project: MyApp

## Quick Commands
- `npm run dev` — Start development server
- `npm test` — Run tests
- `npm run lint` — Check code style

## Architecture
- React frontend in `src/`
- Express API in `api/`
- PostgreSQL database

## Conventions
- Use TypeScript strict mode
- Prefer functional components
- Tests live next to source files (*.test.ts)

## Gotchas
- Auth tokens expire after 1 hour
- Don't modify `generated/` files directly
```

### Comprehensive CLAUDE.md Template
```markdown
# Project: Enterprise App

## Overview
Brief description of what this project does and who it's for.

## Quick Commands
```bash
npm run dev          # Development server (port 3000)
npm run test         # Run all tests
npm run test:watch   # Watch mode
npm run build        # Production build
npm run deploy:staging  # Deploy to staging
```

## Architecture

### Frontend (src/app/)
- Next.js 14 with App Router
- Tailwind CSS for styling
- Zustand for state management

### Backend (src/api/)
- Express.js REST API
- Prisma ORM with PostgreSQL
- Redis for caching

### Key Directories
- `src/components/` — Shared UI components
- `src/features/` — Feature modules (auth, dashboard, etc.)
- `src/lib/` — Utility functions and helpers
- `prisma/` — Database schema and migrations

## Coding Conventions

### TypeScript
- Strict mode enabled
- Prefer `interface` over `type` for objects
- Use `unknown` instead of `any`

### React
- Functional components only
- Custom hooks in `src/hooks/`
- Use React Query for data fetching

### Testing
- Jest + React Testing Library
- Tests colocated with source (`*.test.tsx`)
- Minimum 80% coverage for new code

### Git
- Conventional commits (feat:, fix:, docs:, etc.)
- PRs require 1 approval
- Squash merge to main

## Environment Variables
- `DATABASE_URL` — PostgreSQL connection string
- `REDIS_URL` — Redis connection string  
- `NEXT_PUBLIC_API_URL` — API base URL

## Common Gotchas
- ⚠️ Run `npx prisma generate` after schema changes
- ⚠️ Auth tokens expire after 1 hour (refresh logic in `src/lib/auth.ts`)
- ⚠️ Don't edit `src/generated/` — auto-generated by Prisma

## Recent Decisions
- 2024-01: Migrated from REST to GraphQL for mobile API
- 2024-02: Added Redis caching for user sessions
```

### Scoped Rules (.claude/rules/)
```markdown
# Save to: .claude/rules/api-rules.md
---
paths:
  - src/api/**
  - api/**
---

# API Development Rules

When working on API files:

1. **Always validate input** using Zod schemas
2. **Return consistent error format:**
   ```json
   { "error": { "code": "ERROR_CODE", "message": "Human readable" } }
   ```
3. **Log all errors** with request ID for debugging
4. **Write integration tests** for every endpoint
5. **Document with OpenAPI** comments
```

```markdown
# Save to: .claude/rules/security-rules.md
---
paths:
  - src/auth/**
  - "**/security/**"
  - "**/*auth*"
---

# Security Rules

⚠️ HIGH SENSITIVITY AREA

1. **Never log** passwords, tokens, or PII
2. **Always hash** passwords with bcrypt (cost factor 12)
3. **Validate JWTs** on every authenticated route
4. **Rate limit** auth endpoints (5 attempts per minute)
5. **Require review** for any changes to these files
```

### Using @import Syntax
```markdown
# CLAUDE.md

## Project Overview
[Your overview]

## Imports
@AGENTS.md
@.claude/rules/api-rules.md

## Additional Context
[More content]
```

### Symlinks for Shared Rules
```bash
# Create shared rules in a central location
mkdir -p ~/shared-claude-rules

# Create symlinks in projects
ln -s ~/shared-claude-rules/typescript.md .claude/rules/typescript.md
ln -s ~/shared-claude-rules/security.md .claude/rules/security.md
```

## Prompt Templates

### Create CLAUDE.md
```
Analyse this codebase and create a CLAUDE.md file that includes:
1. Project overview (2-3 sentences)
2. Key commands (dev, test, build, deploy)
3. Architecture summary (what's where)
4. Coding conventions (from existing code patterns)
5. Important gotchas or warnings

Keep it under 200 lines and focus on what you'd need to know to work effectively.
```

### Create Scoped Rules
```
Create scoped rules for our API layer:
1. Path pattern: src/api/**
2. Include input validation requirements
3. Error response format standards
4. Testing requirements
5. Documentation requirements

Save to .claude/rules/api-rules.md
```

### Optimise Context Usage
```
My sessions are running out of context too quickly. Help me:
1. Audit my CLAUDE.md for unnecessary content
2. Move detailed docs to skills or rules files
3. Suggest a /clear strategy for my workflow
4. Set up context-saving hooks
```

## Troubleshooting

### CLAUDE.md Not Loading
```bash
# Check file exists
ls -la CLAUDE.md
ls -la .claude/CLAUDE.md

# Verify permissions
cat CLAUDE.md

# Force reload
/init
```

### Context Running Out
- Use `/clear` between unrelated tasks
- Keep CLAUDE.md under 250 lines
- Move detailed knowledge to skills
- Split large tasks into smaller sessions
- Use subagents for parallel work (separate context)

### Rules Not Applying
```bash
# Check rules files exist
ls -la .claude/rules/

# Verify paths frontmatter matches
cat .claude/rules/my-rules.md

# Test path pattern
# Pattern: src/api/** should match src/api/routes/user.ts
```

### Memory Seems Stale
```bash
# Force reload all memory
/init

# Check what's loaded
/memory

# If still wrong, restart session
# (exit and run `claude` again)
```

### Common Errors

| Error | Cause | Solution |
|-------|-------|----------|
| "CLAUDE.md not found" | Wrong directory | `cd` to project root |
| Rules not matching | Path pattern wrong | Check glob syntax in frontmatter |
| Context too large | CLAUDE.md too verbose | Trim to essentials |
| Compaction losing info | Session too long | Use `/clear` more often |

## Context Window Management

### Understanding the 200K Limit
```
200K tokens ≈ 150,000 words ≈ 300 pages of text

In practice:
- CLAUDE.md: ~500-2000 tokens
- Code files: 100-500 tokens each
- Conversation history: accumulates rapidly
- Tool outputs: can be very large
```

### Strategies for Long Sessions
1. **Checkpoint regularly** — Save important state to files
2. **Use subagents** — Parallel work in separate contexts
3. **Clear between tasks** — `/clear` resets conversation
4. **Summarise progress** — Ask Claude to summarise before clearing
5. **Extract to skills** — Move repeated knowledge to skills

## Related Domains

- **[Skills](03-skills.md)** — Alternative to bloated CLAUDE.md
- **[Workflows](13-workflows.md)** — Context management strategies
- **[Plan Mode](07-plan-mode.md)** — Research without consuming context
- **[Hooks](04-hooks.md)** — PreCompact hook for backup
